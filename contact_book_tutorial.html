<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>教學手冊：從零開始，打造專屬班級的線上家庭聯絡簿</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            line-height: 1.8;
            color: #333;
            background-color: #fdfdfd;
            margin: 0;
            padding: 2rem;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #ffffff;
            padding: 2rem 3rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        h1, h2, h3 {
            color: #1a202c;
            line-height: 1.4;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 0.5rem;
            margin-top: 2rem;
        }
        h1 {
            font-size: 2rem;
            text-align: center;
            border-bottom: none;
            margin-bottom: 2rem;
        }
        h2 {
            font-size: 1.75rem;
        }
        h3 {
            font-size: 1.4rem;
            border-bottom: none;
        }
        p, li {
            font-size: 1.1rem;
            color: #4a5568;
        }
        ul {
            list-style-type: disc;
            padding-left: 2rem;
        }
        li {
            margin-bottom: 0.75rem;
        }
        strong {
            color: #2d3748;
        }
        code {
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;
            background-color: #eef1f5;
            color: #c53030;
            padding: 0.2em 0.4em;
            border-radius: 4px;
            font-size: 0.9em;
        }
        .code-block-wrapper {
            position: relative;
            margin: 1.5rem 0;
        }
        pre {
            background-color: #2d3748;
            color: #e2e8f0;
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 0.95rem;
            line-height: 1.6;
        }
        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #4a5568;
            color: #ffffff;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: background-color 0.2s;
        }
        .copy-btn:hover {
            background-color: #2d3748;
        }
        .copy-btn:active {
            background-color: #1a202c;
        }
        .important {
            background-color: #fffaf0;
            border-left: 4px solid #f6ad55;
            padding: 1rem;
            margin: 1.5rem 0;
            border-radius: 4px;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>從零開始，打造專屬班級的線上家庭聯絡簿</h1>
        
        <h2>前言</h2>
        <p>老師您好！這是一份專為沒有任何程式背景的老師設計的教學手冊。我們的目標是帶領您一步步建立一個 <strong>完全免費、專屬於您班級、可即時更新</strong> 的線上家庭聯絡簿。</p>
        <p>完成後，您將擁有一個獨一無二的網址，家長和學生可以隨時透過手機或電腦查看聯絡簿內容，而您可以透過管理員密碼，輕鬆地在任何地方編輯每日事項。</p>
        <p>請您放輕鬆，跟著我們的步驟，一步一步完成即可！</p>

        <h2>第一部分：註冊必要的免費帳號</h2>
        <p>我們需要兩個主要的免費服務：</p>
        <ul>
            <li><strong>GitHub</strong>：用來存放我們的網頁檔案，並提供免費的網站空間。</li>
            <li><strong>Supabase</strong>：作為我們的線上資料庫，用來儲存聯絡簿的每日內容和設定。</li>
        </ul>

        <h3>步驟一：註冊 GitHub 帳號</h3>
        <ol>
            <li>前往 <strong>GitHub 官方網站</strong>。</li>
            <li>點擊右上角的 <code>Sign up</code>。</li>
            <li>依照畫面指示，輸入您的 Email、設定密碼和使用者名稱。使用者名稱建議使用全英文。</li>
            <li>完成信箱驗證等步驟，直到您成功登入 GitHub 主控台。</li>
        </ol>

        <h3>步驟二：註冊 Supabase 帳號</h3>
        <ol>
            <li>前往 <strong>Supabase 官方網站</strong>。</li>
            <li>點擊 <code>Start your project</code>。</li>
            <li>在註冊頁面，強烈建議直接點擊 <code>Continue with GitHub</code> 按鈕。這會讓兩個帳號連動，未來登入會非常方便。</li>
            <li>授權 Supabase 存取您的 GitHub 帳號。</li>
            <li>完成後，您就會登入 Supabase 的主控台。</li>
        </ol>

        <h2>第二部分：建立您的線上資料庫 (Supabase)</h2>
        <p>這一步我們要建立存放聯絡簿內容的地方。</p>
        
        <h3>步驟一：建立新專案</h3>
        <ol>
            <li>在 Supabase 主控台，點擊 <code>New Project</code>。</li>
            <li><strong>Name</strong>：為您的專案取一個英文名字，例如 <code>my-class-contact-book</code>。</li>
            <li><strong>Database Password</strong>：點擊 <code>Generate a password</code>，系統會產生一組安全的密碼。<strong>請務必將這組密碼複製下來，妥善保存在您自己的筆記本或文件中</strong>，雖然之後不常用到，但以備不時之需。</li>
            <li><strong>Region</strong>：選擇離您最近的地區，例如 <code>Northeast Asia (Tokyo)</code>。</li>
            <li>點擊 <code>Create new project</code>，然後等待幾分鐘讓系統完成初始化。</li>
        </ol>

        <h3>步驟二：建立 <code>contact_book</code> (聯絡簿內容) 資料表</h3>
        <ol>
            <li>專案建立後，點擊左側選單的 <strong>Table Editor</strong> (一個表格圖示)。</li>
            <li>點擊 <code>Create a new table</code>。</li>
            <li><strong>Name</strong>：請務必準確地輸入 <code>contact_book</code>。</li>
            <li><strong>關閉 RLS</strong>：請<strong>取消勾選</strong> <code>Enable Row Level Security (RLS)</code>，確保這個開關是<strong>關閉</strong>的。</li>
            <li><strong>新增欄位 (Columns)</strong>：
                <ul>
                    <li>點擊 <code>Add column</code>，名稱設為 <code>date</code>，類型選擇 <code>date</code>。</li>
                    <li>再次點擊 <code>Add column</code>，名稱設為 <code>content</code>，類型選擇 <code>text</code>。</li>
                </ul>
            </li>
            <li>找到 <code>date</code> 這一欄，點擊右邊的「編輯」圖示(一支筆)，展開 "Advanced settings"，<strong>勾選 "Is Unique"</strong>。</li>
            <li>點擊右下角的 <code>Save</code> 儲存表格。</li>
        </ol>

        <h3>步驟三：建立 <code>settings</code> (系統設定) 資料表</h3>
        <ol>
            <li>再次點擊 <code>Create a new table</code>。</li>
            <li><strong>Name</strong>：請務必準確地輸入 <code>settings</code>。</li>
            <li><strong>關閉 RLS</strong>：同樣<strong>取消勾選</strong> <code>Enable Row Level Security (RLS)</code>。</li>
            <li><strong>新增欄位 (Columns)</strong>：
                <ul>
                    <li>點擊 <code>Add column</code>，名稱設為 <code>title</code>，類型選擇 <code>text</code>，並在 "Default Value" 欄位中輸入 <code>學生家庭聯絡簿</code>。</li>
                    <li>再次點擊 <code>Add column</code>，名稱設為 <code>allow_future_browsing</code>，類型選擇 <code>bool</code>，並在 "Default Value" 欄位中選擇 <code>false</code>。</li>
                </ul>
            </li>
            <li>點擊右下角的 <code>Save</code> 儲存表格。</li>
            <li>表格建立後，點擊上方的 <code>Insert</code> -> <code>Insert row</code>，直接點擊 <code>Save</code>，新增第一筆設定資料。</li>
        </ol>

        <h3>步驟四：建立管理員帳號</h3>
        <ol>
            <li>點擊左側選單的 <strong>Authentication</strong> (一個人像圖示)。</li>
            <li>點擊 <code>Users</code> 分頁，然後點擊 <code>Add user</code>。</li>
            <li>輸入您要用來登入管理介面的 <strong>Email</strong> 和 <strong>密碼</strong>，然後點擊 <code>Create user</code>。這組帳密就是您未來用來編輯聯絡簿的帳號。</li>
        </ol>
        
        <h2>第三部分：準備網頁並上傳 (GitHub)</h2>

        <h3>步驟一：取得 Supabase 連線金鑰</h3>
        <ol>
            <li>回到 Supabase，點擊左側選單最下方的 <strong>Project Settings</strong> (一個齒輪圖示)。</li>
            <li>在設定選單中，點擊 <code>API</code>。</li>
            <li>您會看到兩個我們需要的東西：
                <ul>
                    <li><code>Project URL</code> (專案網址)</li>
                    <li><code>Project API Keys</code> 下方的 <code>anon public</code> 金鑰 (一長串的亂碼)。</li>
                </ul>
            </li>
            <li>請將這兩串文字<strong>分別複製下來</strong>，貼在您的筆記本中備用。</li>
        </ol>
        
        <h3>步驟二：準備網頁 HTML 檔案</h3>
        <ol>
            <li>在您的電腦上，打開一個純文字編輯器（Windows 可用「記事本」，Mac 可用「文字編輯」）。</li>
            <li><strong>完整複製</strong>下方提供的所有程式碼，並貼到文字編輯器中。</li>
        </ol>

        <div class="code-block-wrapper">
            <button class="copy-btn" onclick="copyCode(this)">複製</button>
            <pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang="zh-TW" class="theme-light"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;學生家庭聯絡簿&lt;/title&gt;
    &lt;script src="https://cdn.tailwindcss.com"&gt;&lt;/script&gt;
    &lt;link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet"&gt;
    &lt;style&gt;
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f9fafb; --bg-accent: #f3f4f6;
            --text-primary: #1f2937; --text-secondary: #4b5563; --text-accent: #111827;
            --border-color: #e5e7eb; --brand-color: #3b82f6; --brand-text: #ffffff;
            --brand-hover: #2563eb;
        }
        html.theme-dark {
            --bg-primary: #1f2937;
            --bg-secondary: #374151; --bg-accent: #4b5563;
            --text-primary: #f9fafb; --text-secondary: #d1d5db; --text-accent: #ffffff;
            --border-color: #4b5563; --brand-color: #60a5fa; --brand-text: #1f2937;
            --brand-hover: #3b82f6;
        }
        html.theme-warm {
            --bg-primary: #fffaf0;
            --bg-secondary: #fef3c7; --bg-accent: #fde68a;
            --text-primary: #78350f; --text-secondary: #92400e; --text-accent: #000000;
            --border-color: #fcd34d; --brand-color: #f97316; --brand-text: #ffffff;
            --brand-hover: #ea580c;
        }
        html.theme-cool {
            --bg-primary: #f0f9ff;
            --bg-secondary: #e0f2fe; --bg-accent: #bae6fd;
            --text-primary: #075985; --text-secondary: #0369a1; --text-accent: #0c4a6e;
            --border-color: #7dd3fc; --brand-color: #0ea5e9; --brand-text: #ffffff;
            --brand-hover: #0284c7;
        }
        body {
             font-family: 'Inter', 'Noto Sans TC', sans-serif;
             background-color: var(--bg-accent);
            color: var(--text-primary);
            transition: background-color 0.3s, color 0.3s;
        }
        .main-container { background-color: var(--bg-primary); }
        .calendar-container { background-color: var(--bg-secondary); border-color: var(--border-color); }
        .calendar-day.today { background-color: var(--bg-accent); color: var(--text-accent); }
        .calendar-day.selected { background-color: var(--brand-color); color: var(--brand-text); }
        .calendar-day:disabled { background-color: transparent; color: #d1d5db; cursor: not-allowed; }
        html.theme-dark .calendar-day:disabled { color: #4b5563; }
        .content-area { background-color: var(--bg-secondary); }
        .btn-brand { background-color: var(--brand-color); color: var(--brand-text); }
        .btn-brand:hover { background-color: var(--brand-hover); }
        .modal-overlay { background-color: rgba(0, 0, 0, 0.5); }
        .modal-content { background-color: var(--bg-primary); }
        .form-input { background-color: var(--bg-secondary); border-color: var(--border-color); color: var(--text-primary); }
        .theme-button.active { box-shadow: 0 0 0 2px var(--brand-color); }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body class="flex items-center justify-center min-h-screen p-4"&gt;
    &lt;!-- 頁面結構... --&gt;
    &lt;div class="w-full max-w-5xl mx-auto rounded-2xl shadow-lg flex flex-col md:flex-row overflow-hidden main-container" style="height: 85vh;"&gt;
        &lt;div class="w-full md:w-1/3 p-6 border-b md:border-b-0 md:border-r flex flex-col calendar-container"&gt;
            &lt;h2 id="app-title" class="text-xl font-bold mb-4"&gt;學生家庭聯絡簿&lt;/h2&gt;
            &lt;div class="flex items-center justify-between mb-4"&gt;
                &lt;button id="prev-month" class="p-2 rounded-full hover:bg-gray-200/50"&gt;&lt;svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"&gt;&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/button&gt;
                &lt;h3 id="month-year" class="font-bold text-lg"&gt;&lt;/h3&gt;
                &lt;button id="next-month" class="p-2 rounded-full hover:bg-gray-200/50"&gt;&lt;svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"&gt;&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/button&gt;
            &lt;/div&gt;
            &lt;div class="grid grid-cols-7 text-center text-sm text-gray-500 mb-2"&gt;
                &lt;div&gt;日&lt;/div&gt;&lt;div&gt;一&lt;/div&gt;&lt;div&gt;二&lt;/div&gt;&lt;div&gt;三&lt;/div&gt;&lt;div&gt;四&lt;/div&gt;&lt;div&gt;五&lt;/div&gt;&lt;div&gt;六&lt;/div&gt;
            &lt;/div&gt;
            &lt;div id="calendar-body" class="grid grid-cols-7 gap-1 flex-grow"&gt;&lt;/div&gt;
            &lt;div class="mt-auto pt-4 space-y-2"&gt;
                &lt;button id="settings-btn" class="w-full bg-gray-500 text-white py-2 px-4 rounded-lg hover:bg-gray-600 hidden"&gt;應用程式設定&lt;/button&gt;
                &lt;button id="admin-login-btn" class="w-full py-2 px-4 rounded-lg transition-colors duration-300 btn-brand"&gt;管理員登入&lt;/button&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;div class="w-full md:w-2/3 p-6 md:p-8 flex flex-col"&gt;
            &lt;div class="flex items-center justify-between mb-6"&gt;
                &lt;button id="prev-day" class="flex items-center hover:text-blue-500 transition-colors"&gt;&lt;svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"&gt;&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"&gt;&lt;/path&gt;&lt;/svg&gt;前一天&lt;/button&gt;
                &lt;h1 id="current-date" class="text-2xl font-bold text-center"&gt;&lt;/h1&gt;
                &lt;button id="next-day" class="flex items-center hover:text-blue-500 transition-colors"&gt;後一天&lt;svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"&gt;&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/button&gt;
            &lt;/div&gt;
            &lt;div id="content-area" class="flex-grow p-4 rounded-lg overflow-y-auto prose max-w-none content-area"&gt;&lt;/div&gt;
            &lt;div class="mt-auto pt-4 flex items-end justify-between"&gt;
                &lt;div&gt;
                    &lt;p class="text-sm mb-2"&gt;選擇主題&lt;/p&gt;
                    &lt;div class="flex justify-center space-x-2"&gt;
                        &lt;button class="theme-button w-8 h-8 rounded-full bg-white border-2 border-gray-300" data-theme="light"&gt;&lt;/button&gt;
                        &lt;button class="theme-button w-8 h-8 rounded-full bg-gray-800 border-2 border-gray-600" data-theme="dark"&gt;&lt;/button&gt;
                        &lt;button class="theme-button w-8 h-8 rounded-full bg-amber-400 border-2 border-amber-500" data-theme="warm"&gt;&lt;/button&gt;
                        &lt;button class="theme-button w-8 h-8 rounded-full bg-sky-400 border-2 border-sky-500" data-theme="cool"&gt;&lt;/button&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                &lt;div id="admin-controls" class="text-right hidden"&gt;
                    &lt;span id="mode-indicator" class="text-sm text-green-600 mr-4 font-medium"&gt;&lt;/span&gt;
                    &lt;button id="save-button" class="bg-green-500 text-white py-2 px-6 rounded-lg hover:bg-green-600"&gt;儲存變更&lt;/button&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    &lt;div id="login-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-overlay"&gt;
        &lt;div class="p-8 rounded-lg shadow-xl w-full max-w-sm modal-content"&gt;
            &lt;h2 class="text-2xl font-bold mb-6 text-center"&gt;管理員登入&lt;/h2&gt;
            &lt;form id="login-form"&gt;
                &lt;div class="mb-4"&gt;
                    &lt;label for="email" class="block mb-2 text-sm font-medium"&gt;Email&lt;/label&gt;
                    &lt;input type="email" id="email" class="form-input w-full p-2 border rounded-md" required&gt;
                &lt;/div&gt;
                &lt;div class="mb-6"&gt;
                    &lt;label for="password" class="block mb-2 text-sm font-medium"&gt;密碼&lt;/label&gt;
                    &lt;input type="password" id="password" class="form-input w-full p-2 border rounded-md" required&gt;
                &lt;/div&gt;
                &lt;button type="submit" class="w-full py-2 px-4 rounded-lg btn-brand"&gt;登入&lt;/button&gt;
            &lt;/form&gt;
            &lt;button id="close-login-modal" class="absolute top-4 right-4 text-2xl"&gt;×&lt;/button&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    &lt;div id="settings-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-overlay"&gt;
        &lt;div class="p-8 rounded-lg shadow-xl w-full max-w-md modal-content"&gt;
            &lt;h2 class="text-2xl font-bold mb-6"&gt;應用程式設定&lt;/h2&gt;
            &lt;div class="space-y-6"&gt;
                &lt;div&gt;
                    &lt;label for="title-input" class="block mb-2 text-sm font-medium"&gt;聯絡簿標題&lt;/label&gt;
                    &lt;input type="text" id="title-input" class="form-input w-full p-2 border rounded-md"&gt;
                &lt;/div&gt;
                &lt;div class="flex items-center justify-between"&gt;
                    &lt;label for="future-toggle" class="text-sm font-medium"&gt;允許學生瀏覽未來日期&lt;/label&gt;
                    &lt;label class="relative inline-flex items-center cursor-pointer"&gt;
                        &lt;input type="checkbox" id="future-toggle" class="sr-only peer"&gt;
                        &lt;div class="w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"&gt;&lt;/div&gt;
                    &lt;/label&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            &lt;div class="mt-8 flex justify-end space-x-4"&gt;
                &lt;button id="cancel-settings" class="py-2 px-4 rounded-lg bg-gray-200 hover:bg-gray-300"&gt;取消&lt;/button&gt;
                &lt;button id="save-settings" class="py-2 px-6 rounded-lg btn-brand"&gt;儲存設定&lt;/button&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    &lt;div id="toast-notification" class="fixed bottom-5 left-1/2 -translate-x-1/2 bg-gray-800 text-white py-3 px-6 rounded-lg z-[100] opacity-0 transition-opacity duration-300"&gt;&lt;/div&gt;
    &lt;script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"&gt;&lt;/script&gt;
    &lt;script&gt;
        // --- Supabase Configuration ---
        const supabaseUrl = 'YOUR_SUPABASE_URL';
        const supabaseKey = 'YOUR_SUPABASE_ANON_KEY';

        if (supabaseUrl === 'YOUR_SUPABASE_URL' || supabaseKey === 'YOUR_SUPABASE_ANON_KEY') {
            document.body.innerHTML = `&lt;div class="p-8 bg-red-100 border-l-4 border-red-500 text-red-700 w-full max-w-2xl mx-auto"&gt;&lt;h2 class="font-bold text-xl mb-2"&gt;設定錯誤&lt;/h2&gt;&lt;p&gt;您尚未設定 Supabase 連線資訊。&lt;/p&gt;&lt;p class="mt-2"&gt;請編輯 HTML 檔案，在 &lt;script&gt; 區塊中找到並填寫您自己的 &lt;strong&gt;Supabase Project URL&lt;/strong&gt; 和 &lt;strong&gt;anon Key&lt;/strong&gt;。&lt;/p&gt;&lt;/div&gt;`;
            throw new Error("Supabase configuration is missing.");
        }
        const { createClient } = window.supabase;
        const supabase = createClient(supabaseUrl, supabaseKey);
        const dom = {
            appTitle: document.getElementById('app-title'),
            currentDate: document.getElementById('current-date'),
            contentArea: document.getElementById('content-area'),
            adminLoginBtn: document.getElementById('admin-login-btn'),
            adminControls: document.getElementById('admin-controls'),
            saveButton: document.getElementById('save-button'),
            modeIndicator: document.getElementById('mode-indicator'),
            monthYear: document.getElementById('month-year'),
            calendarBody: document.getElementById('calendar-body'),
            prevDayBtn: document.getElementById('prev-day'),
            nextDayBtn: document.getElementById('next-day'),
            prevMonthBtn: document.getElementById('prev-month'),
            nextMonthBtn: document.getElementById('next-month'),
            toast: document.getElementById('toast-notification'),
            loginModal: {
                el: document.getElementById('login-modal'),
                form: document.getElementById('login-form'),
                closeBtn: document.getElementById('close-login-modal'),
                emailInput: document.getElementById('email'),
                passwordInput: document.getElementById('password')
            },
            settings: {
                btn: document.getElementById('settings-btn'),
                modal: document.getElementById('settings-modal'),
                titleInput: document.getElementById('title-input'),
                futureToggle: document.getElementById('future-toggle'),
                saveBtn: document.getElementById('save-settings'),
                cancelBtn: document.getElementById('cancel-settings')
            }
        };
        let state = {
            currentDate: new Date(),
            calendarDate: new Date(),
            isAdmin: false,
            realtimeChannel: null,
            settings: {
                title: '學生家庭聯絡簿',
                allow_future_browsing: false
            }
        };
        const formatDate = (date) =&gt; `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
        const displayDate = (date) =&gt; date.toLocaleDateString('zh-TW', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' });
        const showToast = (message) =&gt; {
            dom.toast.textContent = message;
            dom.toast.style.opacity = 1;
            setTimeout(() =&gt; { dom.toast.style.opacity = 0; }, 3000);
        };
        const applyTheme = (theme) =&gt; {
            document.documentElement.className = `theme-${theme}`;
            localStorage.setItem('contact-book-theme', theme);
            document.querySelectorAll('.theme-button').forEach(btn =&gt; {
                btn.classList.toggle('active', btn.dataset.theme === theme);
            });
        };
        document.querySelectorAll('.theme-button').forEach(btn =&gt; {
            btn.addEventListener('click', () =&gt; applyTheme(btn.dataset.theme));
        });
        const showModal = (modal) =&gt; {
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        };
        const hideModal = (modal) =&gt; {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        };
        const loadSettings = async () =&gt; {
            const { data, error } = await supabase.from('settings').select('*').eq('id', 1).single();
            if (data) {
                state.settings = data;
                dom.appTitle.textContent = data.title;
                document.title = data.title;
            } else {
                console.warn("Could not load settings, using defaults.", error);
            }
        };
        const listenToContentChanges = async () =&gt; {
            const dateKey = formatDate(state.currentDate);
            const { data, error } = await supabase.from('contact_book').select('content').eq('date', dateKey).single();
            if (error &amp;&amp; error.code !== 'PGRST116') console.error("Error fetching data:", error);
            dom.contentArea.innerHTML = data?.content || (state.isAdmin ? "&lt;h1&gt;點此開始編輯今天的新內容...&lt;/h1&gt;" : "&lt;p&gt;今天沒有內容喔！&lt;/p&gt;");
            if (state.realtimeChannel) supabase.removeChannel(state.realtimeChannel);
            state.realtimeChannel = supabase.channel(`public:contact_book:date=eq.${dateKey}`)
                .on('postgres_changes', { event: '*', schema: 'public', table: 'contact_book', filter: `date=eq.${dateKey}` }, payload =&gt; {
                    dom.contentArea.innerHTML = payload.new.content || (state.isAdmin ? "&lt;h1&gt;點此開始編輯今天的新內容...&lt;/h1&gt;" : "&lt;p&gt;今天沒有內容喔！&lt;/p&gt;");
                }).subscribe();
        };
        const updateView = () =&gt; {
            dom.currentDate.textContent = displayDate(state.currentDate);
            updateNextDayButtonState();
            renderCalendar();
            listenToContentChanges();
        };
        const updateNextDayButtonState = () =&gt; {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const isFuture = state.currentDate &gt;= today;
            const isDisabled = isFuture &amp;&amp; !state.isAdmin &amp;&amp; !state.settings.allow_future_browsing;
            dom.nextDayBtn.disabled = isDisabled;
            dom.nextDayBtn.classList.toggle('text-gray-400', isDisabled);
            dom.nextDayBtn.classList.toggle('cursor-not-allowed', isDisabled);
        };
        const renderCalendar = () =&gt; {
            state.calendarDate.setDate(1);
            const month = state.calendarDate.getMonth(), year = state.calendarDate.getFullYear();
            dom.monthYear.textContent = `${year}年 ${month + 1}月`;
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            dom.calendarBody.innerHTML = '';
            for (let i = 0; i &lt; firstDay; i++) dom.calendarBody.innerHTML += `&lt;div&gt;&lt;/div&gt;`;
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const todayFmt = formatDate(today), currentFmt = formatDate(state.currentDate);
            for (let i = 1; i &lt;= daysInMonth; i++) {
                const dayEl = document.createElement('button');
                const loopDate = new Date(year, month, i);
                dayEl.textContent = i;
                dayEl.className = 'calendar-day p-2 rounded-full hover:bg-gray-200/50 focus:outline-none';
                const loopFmt = formatDate(loopDate);
                if (loopFmt === todayFmt) dayEl.classList.add('today');
                if (loopFmt === currentFmt) dayEl.classList.add('selected');
                const isFuture = loopDate &gt; today;
                const isDisabled = isFuture &amp;&amp; !state.isAdmin &amp;&amp; !state.settings.allow_future_browsing;
                dayEl.disabled = isDisabled;
                if (!isDisabled) {
                    dayEl.onclick = () =&gt; {
                        state.currentDate = new Date(year, month, i);
                        updateView();
                    };
                }
                dom.calendarBody.appendChild(dayEl);
            }
        };
        supabase.auth.onAuthStateChange((event, session) =&gt; {
            state.isAdmin = !!session?.user;
            dom.contentArea.contentEditable = state.isAdmin;
            dom.adminControls.classList.toggle('hidden', !state.isAdmin);
            dom.settings.btn.classList.toggle('hidden', !state.isAdmin);
            if (state.isAdmin) {
                dom.adminLoginBtn.textContent = '登出管理員';
                dom.adminLoginBtn.classList.replace('bg-blue-500', 'bg-red-500');
                dom.modeIndicator.textContent = '管理員模式';
            } else {
                dom.adminLoginBtn.textContent = '管理員登入';
                dom.adminLoginBtn.classList.replace('bg-red-500', 'bg-blue-500');
            }
            updateView();
        });
        const setupEventListeners = () =&gt; {
            dom.prevDayBtn.onclick = () =&gt; { state.currentDate.setDate(state.currentDate.getDate() - 1); updateView(); };
            dom.nextDayBtn.onclick = () =&gt; { state.currentDate.setDate(state.currentDate.getDate() + 1); updateView(); };
            dom.prevMonthBtn.onclick = () =&gt; { state.calendarDate.setMonth(state.calendarDate.getMonth() - 1); renderCalendar(); };
            dom.nextMonthBtn.onclick = () =&gt; { state.calendarDate.setMonth(state.calendarDate.getMonth() + 1); renderCalendar(); };
            dom.adminLoginBtn.onclick = () =&gt; state.isAdmin ? supabase.auth.signOut() : showModal(dom.loginModal.el);
            dom.loginModal.closeBtn.onclick = () =&gt; hideModal(dom.loginModal.el);
            dom.loginModal.form.onsubmit = async (e) =&gt; {
                e.preventDefault();
                const { error } = await supabase.auth.signInWithPassword({ email: dom.loginModal.emailInput.value, password: dom.loginModal.passwordInput.value });
                if (error) alert("登入失敗，請檢查您的帳號密碼。");
                else { showToast("登入成功！"); hideModal(dom.loginModal.el); dom.loginModal.form.reset(); }
            };
            dom.saveButton.onclick = async () =&gt; {
                const dateKey = formatDate(state.currentDate);
                const { error } = await supabase.from('contact_book').upsert({ date: dateKey, content: dom.contentArea.innerHTML }, { onConflict: 'date' });
                showToast(error ? "儲存失敗" : "資料已成功儲存至雲端！");
            };
            dom.settings.btn.onclick = () =&gt; {
                dom.settings.titleInput.value = state.settings.title;
                dom.settings.futureToggle.checked = state.settings.allow_future_browsing;
                showModal(dom.settings.modal);
            };
            dom.settings.cancelBtn.onclick = () =&gt; hideModal(dom.settings.modal);
            dom.settings.saveBtn.onclick = async () =&gt; {
                const newSettings = {
                    title: dom.settings.titleInput.value,
                    allow_future_browsing: dom.settings.futureToggle.checked
                };
                const { error } = await supabase.from('settings').update(newSettings).eq('id', 1);
                if (!error) {
                    await loadSettings();
                    updateView();
                    showToast("設定已儲存！");
                } else {
                    showToast("儲存設定失敗！請確認已建立 settings 資料表。");
                }
                hideModal(dom.settings.modal);
            };
        };
        const init = async () =&gt; {
            state.currentDate.setHours(0, 0, 0, 0);
            state.calendarDate = new Date(state.currentDate);
            const savedTheme = localStorage.getItem('contact-book-theme') || 'light';
            applyTheme(savedTheme);
            await loadSettings();
            setupEventListeners();
        };
        init();
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
        </div>
        
        <ol start="3">
            <li><strong>修改金鑰</strong>：在程式碼中找到以下兩行：
                <div class="code-block-wrapper">
                    <button class="copy-btn" onclick="copyCode(this)">複製</button>
                    <pre><code>const supabaseUrl = 'YOUR_SUPABASE_URL';
const supabaseKey = 'YOUR_SUPABASE_ANON_KEY';</code></pre>
                </div>
                將 <code>'YOUR_SUPABASE_URL'</code> 和 <code>'YOUR_SUPABASE_ANON_KEY'</code> 分別替換成您在 <strong>第三部分-步驟一</strong> 複製下來的真實 <strong>URL</strong> 和 <strong>anon Key</strong>。
            </li>
            <li><strong>儲存檔案</strong>：將檔案儲存為 <code>index.html</code>。</li>
        </ol>

        <h3>步驟三：上傳檔案至 GitHub</h3>
        <ol>
            <li>回到 GitHub，點擊 <code>Create repository</code> 建立一個新的倉庫。</li>
            <li><strong>Repository name</strong>：取一個英文名稱，例如 <code>contact-book-website</code>。</li>
            <li>選擇 <strong>Public</strong> (公開)。</li>
            <li>點擊 <code>Create repository</code>。</li>
            <li>在新的倉庫頁面中，點擊 <code>uploading an existing file</code> 的連結。</li>
            <li>將您剛剛儲存的 <code>index.html</code> 檔案拖曳到上傳區域。</li>
            <li>點擊下方的 <code>Commit changes</code>。</li>
        </ol>

        <h2>第四部分：發佈您的網站 (GitHub Pages)</h2>
        <ol>
            <li>在您的 GitHub 倉庫頁面，點擊上方的 <code>Settings</code>。</li>
            <li>在左側選單點擊 <code>Pages</code>。</li>
            <li>在 "Branch" 區塊，將來源從 "None" 改為 <code>main</code>。</li>
            <li>點擊 <code>Save</code>。</li>
            <li>畫面會重新整理，請稍待一兩分鐘，頁面頂端會出現一個綠色提示框，裡面就是您網站的公開網址！</li>
        </ol>

        <h2>第五部分：啟用安全防護 (Supabase RLS)</h2>
        <div class="important">
            <p>這是<strong>非常重要</strong>的最後一步，能保護您的資料不被惡意竄改。</p>
        </div>
        <ol>
            <li>回到 Supabase 專案，點擊左側選單的 <strong>Authentication</strong> (人像圖示)，然後點擊 <code>Policies</code>。</li>
            <li><strong>為 <code>contact_book</code> 表格設定</strong>：
                <ul>
                    <li>找到 <code>contact_book</code> 表格，點擊「Enable RLS」。</li>
                    <li>點擊「New Policy」，選擇「Get started quickly」。</li>
                    <li><strong>讀取規則</strong>：選擇「Enable read access for everyone」，點擊「Review」->「Save policy」。</li>
                    <li><strong>寫入規則</strong>：再次為 <code>contact_book</code> 新增 Policy，選擇「Enable insert access for authenticated users only」，在 USING 和 WITH CHECK 中都填入 <code>true</code>，然後儲存。</li>
                    <li><strong>更新規則</strong>：再次為 <code>contact_book</code> 新增 Policy，選擇「Enable update access for authenticated users only」，在 USING 和 WITH CHECK 中都填入 <code>true</code>，然後儲存。</li>
                </ul>
            </li>
            <li><strong>為 <code>settings</code> 表格設定</strong>：
                 <ul>
                    <li>找到 <code>settings</code> 表格，點擊「Enable RLS」。</li>
                    <li><strong>讀取規則</strong>：選擇「Enable read access for everyone」，儲存。</li>
                    <li><strong>更新規則</strong>：選擇「Enable update access for authenticated users only」，在 USING 和 WITH CHECK 中都填入 <code>true</code>，然後儲存。</li>
                </ul>
            </li>
        </ol>

        <h2>恭喜您！</h2>
        <p>您已經成功建立並發佈了專屬於您班級的線上聯絡簿！現在，您可以將第四部分取得的網址分享給家長和學生。當您需要編輯內容時，只需點擊「管理員登入」，並使用您在 <strong>第二部分-步驟四</strong> 建立的帳密即可。</p>
        <p>祝您使用愉快！</p>

    </div>

    <script>
        function copyCode(button) {
            const pre = button.nextElementSibling;
            const code = pre.querySelector('code');
            const textToCopy = code.innerText;

            navigator.clipboard.writeText(textToCopy).then(() => {
                button.textContent = '已複製！';
                setTimeout(() => {
                    button.textContent = '複製';
                }, 2000);
            }).catch(err => {
                console.error('複製失敗:', err);
                button.textContent = '失敗';
            });
        }
    </script>
</body>
</html>